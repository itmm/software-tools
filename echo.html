<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>echo</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>echo</h1>
<div class="slides">
<div><div>
<h1>echo</h1>
</div>

<ul><li>
 Gibt alle Argumente aus
</li></ul></div>

<div><div>
<code>

<span class="macro">@globdef(<span class="name">file: echo.s</span>)</span><br/>

<span class="in1"></span>.<span class="var">text</span><br/>

<span class="in1"></span>.<span class="var">global</span> <span class="var">main</span><br/>

<span class="fn">main</span>:<br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r4</span>, <span class="var">lr</span><br/>

<span class="in1"></span><span class="macro">@expand(<span class="name">loop</span>)</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r0</span>, #<span class="num">0</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">pc</span>, <span class="var">r4</span><br/>

<span class="macro">@end(<span class="name">file: echo.s</span>)</span><br/>

</code>
</div>

<ul><li>
 Der ausführbare Bereich besteht nur aus der <code>main</code>-Funktion
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">loop</span>)</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r5</span>, <span class="var">r0</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r6</span>, <span class="var">r1</span><br/>

<span class="macro">@end(<span class="name">loop</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Anzahl der Argumente plus eins <code>r0</code> wird in <code>r5</code> gesichert
</li><li>
 Der Zeiger auf die Liste der Argument <code>r1</code> wird in <code>r6</code> gesichert
</li><li>
 Die Register <code>r0</code> und <code>r1</code> können von Funktionsaufrufen verändert
  werden
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">next arg</span>)</span><br/>

<span class="in1"></span><span class="var">add</span> <span class="var">r6</span>, <span class="var">r6</span>, #<span class="num">4</span><br/>

<span class="in1"></span><span class="var">subs</span> <span class="var">r5</span>, <span class="var">r5</span>, #<span class="num">1</span><br/>

<span class="in1"></span><span class="var">beq</span> <span class="var">done</span><br/>

<span class="macro">@end(<span class="name">next arg</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Zähler werden in diesem Fragment weiter gezählt
</li><li>
 Wenn das Ende erreicht ist, wird zum Ende der Schleife gesprungen
</li><li>
 Dieser Teil ist als Fragment ausgelagert, da er zweimal verwendet
  wird
</li></ul></div>

<div><div>
<code>

<span class="macro">@add(<span class="name">loop</span>)</span><br/>

<span class="in1"></span><span class="macro">@multiple(<span class="name">next arg</span>)</span><br/>

<span class="var">loop</span>:<br/>

<span class="in1"></span><span class="macro">@expand(<span class="name">write arg</span>)</span><br/>

<span class="in1"></span><span class="macro">@multiple(<span class="name">next arg</span>)</span><br/>

<span class="in1"></span><span class="macro">@expand(<span class="name">write space</span>)</span><br/>

<span class="in1"></span><span class="var">b</span> <span class="var">loop</span><br/>

<span class="var">done</span>:<br/>

<span class="in1"></span><span class="macro">@expand(<span class="name">write newline</span>)</span><br/>

<span class="macro">@end(<span class="name">loop</span>)</span><br/>

</code>
</div>

<ul><li>
 Da bei allen außer dem ersten Argument ein Leerzeichen vor dem
  Argument ausgegeben werden soll muss zweimal die Zähler angepaßt
  werden
</li><li>
 Alternativ könnte in einem weiteren Register ein Flag abgelegt werden
</li><li>
 Das Fragment wurde vorher definiert, um Endlosschleifen an dieser
  Stelle zu vermeiden
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">write arg</span>)</span><br/>

<span class="in1"></span><span class="var">ldr</span> <span class="var">r7</span>, [<span class="var">r6</span>]<br/>

<span class="var">write_arg_loop</span>:<br/>

<span class="in1"></span><span class="var">ldrb</span> <span class="var">r0</span>, [<span class="var">r7</span>], #<span class="num">1</span><br/>

<span class="in1"></span><span class="var">cmp</span> <span class="var">r0</span>, #<span class="num">0</span><br/>

<span class="in1"></span><span class="var">beq</span> <span class="var">write_arg_end</span><br/>

<span class="in1"></span><span class="var">bl</span> <span class="fn">putchar</span><br/>

<span class="in1"></span><span class="var">b</span> <span class="var">write_arg_loop</span><br/>

<span class="var">write_arg_end</span>:<br/>

<span class="macro">@end(<span class="name">write arg</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Ausgabe erfolgt Zeichen für Zeichen bis das abschließende
  Null-Byte erreicht ist
</li><li>
 Alternativ könnten die C-Funktionen <code>puts</code> oder <code>printf</code> verwendet
  werden
</li><li>
 Aber es wird versucht, die Abhängigkeit zur C-Bibliothek zu reduzieren
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">write space</span>)</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r0</span>, <span class="str">$' </span><br/>

<span class="in1"></span><span class="var">bl</span> <span class="fn">putchar</span><br/>

<span class="macro">@end(<span class="name">write space</span>)</span><br/>

</code>
</div>

<ul><li>
 Gibt ein Leerzeichen aus
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">write newline</span>)</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r0</span>, <span class="str">$'\n</span><br/>

<span class="in1"></span><span class="var">bl</span> <span class="fn">putchar</span><br/>

<span class="macro">@end(<span class="name">write newline</span>)</span><br/>

</code>
</div>

<ul><li>
 Gibt einen Zeilenumbruch aus
</li></ul></div>


<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>copy</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>copy</h1>
<div class="slides">
<div><div>
<h1>copy</h1>
</div>

<ul><li>
 Kopiert Eingabe in Ausgabe
</li><li>
 Um das Programm einfach zu halten, werden Ein- und Ausgaben über
  C-Funktionen ausgeführt
</li><li>
 Es wird so lange einzelne Zeichen gelesen und ausgegeben, bis das
  Ende der Eingabe erreicht ist
</li></ul></div>

<div><div>
<code>

<span class="macro">@globdef(<span class="name">file: copy.s</span>)</span><br/>

<span class="in1"></span>.<span class="var">text</span><br/>

<span class="in1"></span>.<span class="var">global</span> <span class="var">main</span><br/>

<span class="fn">main</span>:<br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r4</span>, <span class="var">lr</span><br/>

<span class="in1"></span><span class="macro">@expand(<span class="name">loop</span>)</span><br/>

<span class="var">done</span>:<br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">r0</span>, #<span class="num">0</span><br/>

<span class="in1"></span><span class="var">mov</span> <span class="var">pc</span>, <span class="var">r4</span><br/>

<span class="macro">@end(<span class="name">file: copy.s</span>)</span><br/>

</code>
</div>

<ul><li>
 Der ausführbare Bereich besteht nur aus der <code>main</code>-Funktion
</li><li>
 Diese ist global sichtbar, damit sie vom C Startup-Code angesprungen
  werden kann
</li><li>
 Der Rücksprung-Wert wird in das Register <code>r4</code> gesichert
</li><li>
 Die Register <code>r0</code> bis <code>r3</code> können von Funktionen verändert werden
</li><li>
 Am Ende wird der Return-Wert auf <code>0</code> gesetzt
</li><li>
 Und die Funktion verlassen
</li></ul></div>

<div><div>
<code>

<span class="macro">@def(<span class="name">loop</span>)</span><br/>

<span class="var">loop</span>:<br/>

<span class="in1"></span><span class="var">bl</span> <span class="fn">getchar</span><br/>

<span class="in1"></span><span class="var">cmp</span> <span class="var">r0</span>, #<span class="num">0</span><br/>

<span class="in1"></span><span class="var">blt</span> <span class="var">done</span><br/>

<span class="in1"></span><span class="var">bl</span> <span class="fn">putchar</span><br/>

<span class="in1"></span><span class="var">b</span> <span class="var">loop</span><br/>

<span class="macro">@end(<span class="name">loop</span>)</span><br/>

</code>
</div>

<ul><li>
 In der Hauptschleife werden einzelne Zeichen mit der C-Funktion
  <code>getchar</code> gelesen
</li><li>
 Wenn das Ende erreicht ist, dann ist der Rückgabewert der Funktion
  negativ
</li><li>
 Und das Ende ist erreicht
</li><li>
 Ansonsten wird das Zeichen mit der Funktion <code>putchar</code> ausgegeben
</li><li>
 Und das nächste Zeichen gelesen
</li></ul></div>

